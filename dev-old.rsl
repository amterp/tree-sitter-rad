#!/usr/bin/env rad
---
Rebuild & test the grammar.
---
args:
    no_test T bool # Enable to skip tests.
    update u bool # Enable to get asked if tests should be updated by tree sitter.

// might need npm install?
$!`tree-sitter generate -b`

if no_test:
    exit()

test_cmd = `tree-sitter test --show-fields`
err = unsafe $test_cmd
if err != 0 and update:
    test_cmd += " --update"
    if confirm("Update tests? [y/n] > "):
        $!test_cmd

if confirm("Push? [y/n] > "):
    $!`./push.rsl --skip-tests`
